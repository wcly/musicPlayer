var dataList,len,indexControl,timer,root=window.player,audio=root.audioManager;function init(){getData("../mock/data.json"),bindEvent(),bindTouch()}function getData(o){$.ajax({type:"GET",url:o,success:function(o){len=(dataList=o).length;var t=(indexControl=new root.indexControl(len)).index;root.render(dataList[t]),audio.getAudio(dataList[t].audio),$("body").trigger("play:change",0)},error:function(){console.log("error")}})}function bindEvent(){$("body").on("play:change",function(o,t){audio.getAudio(dataList[t].audio),root.render(dataList[t]),root.pro.renderAllTime(dataList[t].duration),"play"==audio.status?(rotated(0),audio.play(),root.pro.start(0)):root.pro.stop(0),$(".img-box").attr("data-deg",0),$(".img-box").css({transform:"rotateZ(0deg)",transition:"none"})}),$(".prev").on("click",function(){var o=indexControl.prev();$("body").trigger("play:change",o),"pause"==audio.status&&(audio.pause(),root.pro.stop())}),$(".next").on("click",function(){var o=indexControl.next();$("body").trigger("play:change",o),"pause"==audio.status&&(audio.pause(),root.pro.stop())}),$(".play").on("click",function(){"pause"==audio.status?(audio.play(),root.pro.start(),rotated($(".img-box").attr("data-deg"))):(audio.pause(),root.pro.stop(),clearInterval(timer));$(".play").toggleClass("playing")})}function rotated(o){clearInterval(timer),o=+o,timer=setInterval(function(){o+=2,$(".img-box").attr("data-deg",o),$(".img-box").css({transform:"rotateZ("+o+"deg)",transition:"all 200ms ease-out"})},200)}function bindTouch(){var o=$(".pro-wrap").offset(),n=o.left,r=o.width;$(".spot").on("touchstart",function(){root.pro.stop()}).on("touchmove",function(o){var t=(o.changedTouches[0].clientX-n)/r;0<t&&t<1&&root.pro.update(t)}).on("touchend",function(o){var t=(o.changedTouches[0].clientX-n)/r;if(0<t&&t<1){var a=t*dataList[indexControl.index].duration;$(".play").addClass("playing"),audio.playTo(a),audio.play(),audio.status="play",root.pro.start(t)}})}init();